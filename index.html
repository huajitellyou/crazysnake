<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>高级贪吃蛇游戏</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            padding: 20px;
            color: #fff;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            width: 100%;
            max-width: 800px;
        }
        
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            background: linear-gradient(to right, #ff9a9e, #fad0c4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 800px;
            gap: 20px;
        }
        
        .stats-panel {
            display: flex;
            justify-content: space-between;
            width: 100%;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .stat-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 20px;
        }
        
        .stat-box h3 {
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #ffcc70;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4cc9f0;
        }
        
        .canvas-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            aspect-ratio: 1/1;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            background: rgba(0, 20, 40, 0.85);
        }
        
        #gameCanvas {
            background: transparent;
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            width: 100%;
            justify-content: center;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #2193b0, #6dd5ed);
            color: white;
            box-shadow: 0 4px 15px rgba(33, 147, 176, 0.4);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(33, 147, 176, 0.6);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn.pause {
            background: linear-gradient(45deg, #ff9a9e, #fad0c4);
        }
        
        .btn.reset {
            background: linear-gradient(45deg, #ff758c, #ff7eb3);
        }
        
        .switch-container {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 50px;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ff6b6b;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #4ecdc4;
        }
        
        input:checked + .slider:before {
            transform: translateX(30px);
        }
        
        .mobile-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
            width: 100%;
            max-width: 300px;
            height: 300px;
            margin-top: 10px;
            display: none;
        }
        
        .mobile-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .mobile-btn:active {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(0.95);
        }
        
        .up {
            grid-column: 2;
            grid-row: 1;
        }
        
        .down {
            grid-column: 2;
            grid-row: 3;
        }
        
        .left {
            grid-column: 1;
            grid-row: 2;
        }
        
        .right {
            grid-column: 3;
            grid-row: 2;
        }
        
        .settings-panel {
            width: 100%;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .settings-panel h2 {
            color: #ffcc70;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8rem;
        }
        
        .upload-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            gap: 20px;
        }
        
        .upload-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 200px;
        }
        
        .upload-group label {
            font-size: 1.2rem;
            color: #4cc9f0;
        }
        
        .preview {
            width: 100px;
            height: 100px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .preview-text {
            font-size: 0.9rem;
            color: #aaa;
            text-align: center;
        }
        
        .upload-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px dashed rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .upload-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            display: none;
        }
        
        .game-over h2 {
            font-size: 3rem;
            color: #ff6b6b;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }
        
        .game-over p {
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: #4cc9f0;
        }
        
        @media (max-width: 768px) {
            .mobile-controls {
                display: grid;
            }
            
            .stats-panel {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .stat-box {
                padding: 5px 10px;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 1rem;
            }
            
            .upload-container {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .stat-box h3 {
                font-size: 1rem;
            }
            
            .stat-value {
                font-size: 1.4rem;
            }
            
            .btn {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
            
            .mobile-controls {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-snake"></i> 高级贪吃蛇游戏 <i class="fas fa-apple-alt"></i></h1>
        <p>使用方向键控制蛇的移动，吃到食物增长身体，避免撞墙或撞到自己！</p>
    </div>
    
    <div class="game-container">
        <div class="stats-panel">
            <div class="stat-box">
                <h3>当前得分</h3>
                <div id="score" class="stat-value">0</div>
            </div>
            <div class="stat-box">
                <h3>当前速度</h3>
                <div id="speed" class="stat-value">5</div>
            </div>
            <div class="stat-box">
                <h3>身体长度</h3>
                <div id="length" class="stat-value">3</div>
            </div>
        </div>
        
        <div class="canvas-container">
            <canvas id="gameCanvas"></canvas>
            <div class="game-over" id="gameOver">
                <h2>游戏结束!</h2>
                <p>你的得分: <span id="finalScore">0</span></p>
                <button class="btn reset" id="restartBtn">重新开始</button>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn" id="startBtn"><i class="fas fa-play"></i> 开始游戏</button>
            <button class="btn pause" id="pauseBtn"><i class="fas fa-pause"></i> 暂停</button>
            <button class="btn reset" id="resetBtn"><i class="fas fa-redo"></i> 重新开始</button>
            
            <div class="switch-container">
                <span>加速模式:</span>
                <label class="switch">
                    <input type="checkbox" id="speedToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <div class="mobile-controls">
            <div class="mobile-btn up" id="upBtn"><i class="fas fa-arrow-up"></i></div>
            <div class="mobile-btn down" id="downBtn"><i class="fas fa-arrow-down"></i></div>
            <div class="mobile-btn left" id="leftBtn"><i class="fas fa-arrow-left"></i></div>
            <div class="mobile-btn right" id="rightBtn"><i class="fas fa-arrow-right"></i></div>
        </div>
        
        <div class="settings-panel">
            <h2><i class="fas fa-cog"></i> 自定义游戏外观</h2>
            <div class="upload-container">
                <div class="upload-group">
                    <label>蛇头贴图</label>
                    <div class="preview" id="snakeHeadPreview">
                        <div class="preview-text">默认</div>
                    </div>
                    <div class="upload-btn">
                        <input type="file" id="snakeHeadUpload" accept="image/*" style="display:none">
                        <label for="snakeHeadUpload" style="cursor:pointer">上传图片</label>
                    </div>
                </div>
                
                <div class="upload-group">
                    <label>蛇身贴图</label>
                    <div class="preview" id="snakeBodyPreview">
                        <div class="preview-text">默认</div>
                    </div>
                    <div class="upload-btn">
                        <input type="file" id="snakeBodyUpload" accept="image/*" style="display:none">
                        <label for="snakeBodyUpload" style="cursor:pointer">上传图片</label>
                    </div>
                </div>
                
                <div class="upload-group">
                    <label>食物贴图</label>
                    <div class="preview" id="foodPreview">
                        <div class="preview-text">默认</div>
                    </div>
                    <div class="upload-btn">
                        <input type="file" id="foodUpload" accept="image/*" style="display:none">
                        <label for="foodUpload" style="cursor:pointer">上传图片</label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 获取Canvas和上下文
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // 设置Canvas尺寸
            function resizeCanvas() {
                const size = Math.min(window.innerWidth * 0.9, 600);
                canvas.width = size;
                canvas.height = size;
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // 游戏变量
            const gridSize = 20;
            const tileCount = canvas.width / gridSize;
            let snake = [];
            let food = {};
            let score = 0;
            let velocityX = 0;
            let velocityY = 0;
            let gameLoop;
            let isPaused = false;
            let isGameRunning = false;
            let speed = 150; // 初始速度（毫秒）
            let baseSpeed = 150;
            let speedLevel = 5;
            let speedToggle = true;
            
            // 贴图变量
            let snakeHeadImg = null;
            let snakeBodyImg = null;
            let foodImg = null;
            
            // 默认绘制函数 - 优化版本
            function drawDefaultSnakeHead(x, y, width, height) {
                // 绘制蛇头（三角形）
                ctx.fillStyle = '#2e8b57';
                ctx.beginPath();
                
                // 根据移动方向绘制三角形
                if (velocityX === 1) { // 向右
                    ctx.moveTo(x, y + height/2);
                    ctx.lineTo(x + width, y);
                    ctx.lineTo(x + width, y + height);
                } else if (velocityX === -1) { // 向左
                    ctx.moveTo(x + width, y + height/2);
                    ctx.lineTo(x, y);
                    ctx.lineTo(x, y + height);
                } else if (velocityY === 1) { // 向下
                    ctx.moveTo(x + width/2, y);
                    ctx.lineTo(x, y + height);
                    ctx.lineTo(x + width, y + height);
                } else { // 向上（默认）
                    ctx.moveTo(x + width/2, y + height);
                    ctx.lineTo(x, y);
                    ctx.lineTo(x + width, y);
                }
                
                ctx.closePath();
                ctx.fill();
                
                // 眼睛（根据移动方向调整位置）
                const eyeSize = width / 8;
                if (velocityX === 1 || velocityX === -1) {
                    // 水平移动时眼睛在两侧
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(x + width - eyeSize*3, y + height/3, eyeSize, 0, Math.PI * 2);
                    ctx.arc(x + width - eyeSize*3, y + 2*height/3, eyeSize, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = 'black';
                    ctx.beginPath();
                    ctx.arc(x + width - eyeSize*3, y + height/3, eyeSize/1.5, 0, Math.PI * 2);
                    ctx.arc(x + width - eyeSize*3, y + 2*height/3, eyeSize/1.5, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    // 垂直移动时眼睛在上下
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(x + width/3, y + height - eyeSize*3, eyeSize, 0, Math.PI * 2);
                    ctx.arc(x + 2*width/3, y + height - eyeSize*3, eyeSize, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = 'black';
                    ctx.beginPath();
                    ctx.arc(x + width/3, y + height - eyeSize*3, eyeSize/1.5, 0, Math.PI * 2);
                    ctx.arc(x + 2*width/3, y + height - eyeSize*3, eyeSize/1.5, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            function drawDefaultSnakeBody(x, y, width, height, index, total) {
                // 创建渐变效果 - 从深绿到浅绿
                const gradient = ctx.createLinearGradient(x, y, x + width, y + height);
                const gradientValue = 1 - (index / total) * 0.3; // 尾部颜色变浅
                gradient.addColorStop(0, `hsl(120, 70%, ${25 + gradientValue * 30}%)`);
                gradient.addColorStop(1, `hsl(120, 70%, ${35 + gradientValue * 30}%)`);
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.roundRect(x, y, width, height, width/4);
                ctx.fill();
                
                // 添加身体分节效果
                if (index > 0 && index < total - 1) {
                    ctx.fillStyle = '#1a5e37';
                    ctx.beginPath();
                    ctx.roundRect(x + width/4, y + height/4, width/2, height/2, width/8);
                    ctx.fill();
                }
            }
            
            function drawDefaultFood(x, y, width, height) {
                // 苹果主体
                ctx.fillStyle = '#ff6b6b';
                ctx.beginPath();
                ctx.ellipse(x + width/2, y + height/2, width/2, height/2, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // 苹果叶子
                ctx.fillStyle = '#3cb371';
                ctx.beginPath();
                ctx.moveTo(x + width/2, y + height/4);
                ctx.lineTo(x + width/3, y + height/6);
                ctx.lineTo(x + width/2, y + height/3);
                ctx.fill();
                
                // 苹果柄
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(x + width/2, y + height/4);
                ctx.lineTo(x + width/2, y);
                ctx.stroke();
            }
            
            // 初始化游戏
            function initGame() {
                snake = [
                    {x: Math.floor(tileCount/2), y: Math.floor(tileCount/2)}
                ];
                score = 0;
                velocityX = 0;
                velocityY = 0;
                speed = baseSpeed;
                speedLevel = 5;
                updateStats();
                
                generateFood();
                draw();
            }
            
            // 生成食物
            function generateFood() {
                food = {
                    x: Math.floor(Math.random() * tileCount),
                    y: Math.floor(Math.random() * tileCount)
                };
                
                // 确保食物不会出现在蛇身上
                for (let segment of snake) {
                    if (segment.x === food.x && segment.y === food.y) {
                        return generateFood();
                    }
                }
            }
            
            // 游戏主循环
            function game() {
                if (isPaused || !isGameRunning) return;
                
                // 移动蛇
                const head = {x: snake[0].x + velocityX, y: snake[0].y + velocityY};
                snake.unshift(head);
                
                // 检查是否吃到食物
                if (head.x === food.x && head.y === food.y) {
                    score += 10;
                    
                    // 如果开启了加速模式
                    if (speedToggle && speed > 60) {
                        speed -= 5;
                        speedLevel = Math.max(1, Math.floor((baseSpeed - speed) / 18) + 1);
                    }
                    
                    generateFood();
                } else {
                    snake.pop();
                }
                
                // 检查碰撞
                if (
                    head.x < 0 || head.x >= tileCount || 
                    head.y < 0 || head.y >= tileCount ||
                    checkSelfCollision()
                ) {
                    gameOver();
                    return;
                }
                
                // 绘制游戏
                draw();
                
                // 继续游戏循环
                gameLoop = setTimeout(game, speed);
            }
            
            // 检查蛇是否撞到自己
            function checkSelfCollision() {
                const head = snake[0];
                for (let i = 1; i < snake.length; i++) {
                    if (snake[i].x === head.x && snake[i.y] === head.y) {
                        return true;
                    }
                }
                return false;
            }
            
            // 绘制游戏
            function draw() {
                // 清空画布
                ctx.fillStyle = 'rgba(0, 20, 40, 0.9)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // 绘制网格
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                ctx.lineWidth = 0.5;
                for (let i = 0; i < tileCount; i++) {
                    ctx.beginPath();
                    ctx.moveTo(i * gridSize, 0);
                    ctx.lineTo(i * gridSize, canvas.height);
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.moveTo(0, i * gridSize);
                    ctx.lineTo(canvas.width, i * gridSize);
                    ctx.stroke();
                }
                
                // 绘制食物
                if (foodImg) {
                    ctx.drawImage(foodImg, food.x * gridSize, food.y * gridSize, gridSize, gridSize);
                } else {
                    drawDefaultFood(food.x * gridSize, food.y * gridSize, gridSize, gridSize);
                }
                
                // 绘制蛇 - 从尾部到头部（确保头部在顶部）
                for (let i = snake.length - 1; i >= 0; i--) {
                    // 计算每个身体部分的宽度（头大身匀尾窄）
                    let segmentWidth, segmentHeight;
                    
                    if (i === 0) {
                        // 头部 - 较大
                        segmentWidth = gridSize * 0.9;
                        segmentHeight = gridSize * 0.9;
                    } else if (i >= snake.length - 3) {
                        // 尾部 - 逐渐变小
                        const tailIndex = snake.length - i - 1;
                        const sizeFactor = 0.7 - tailIndex * 0.1;
                        segmentWidth = gridSize * sizeFactor;
                        segmentHeight = gridSize * sizeFactor;
                    } else {
                        // 身体部分 - 均匀
                        segmentWidth = gridSize * 0.8;
                        segmentHeight = gridSize * 0.8;
                    }
                    
                    const offsetX = (gridSize - segmentWidth) / 2;
                    const offsetY = (gridSize - segmentHeight) / 2;
                    
                    if (i === 0) { // 蛇头
                        if (snakeHeadImg) {
                            ctx.drawImage(snakeHeadImg, 
                                snake[i].x * gridSize + offsetX, 
                                snake[i].y * gridSize + offsetY, 
                                segment
